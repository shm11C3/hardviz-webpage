---
import Download from "../../components/Download.tsx";
import Features from "../../components/Features.astro";
import Footer from "../../components/Footer.astro";
import Header from "../../components/Header.astro";
import Hero from "../../components/Hero.astro";
import Insights from "../../components/Insights.astro";
import Screenshots from "../../components/Screenshots.astro";
import Usage from "../../components/Usage.astro";
import { fetchLatestRelease } from "../../funcs/fetchReleaseData.ts";
import Layout from "../../layouts/Layout.astro";
import type { PlatformDownload } from "../../types/platform";
import { getTranslations, defaultLang } from "../../lib/i18n";

const { lang = defaultLang } = Astro.params;
const t = getTranslations(lang);

const release = await fetchLatestRelease();

const downloads: PlatformDownload[] = [
  {
    platform: "Windows",
    versions: [
      {
        type: "windows",
        name: "Windows 10/11 (x64)",
        url: release.platforms.windows?.browser_download_url ?? null,
        size: release.platforms.windows?.size ?? "-",
      },
    ],
    primary: false,
  },
  {
    platform: "Linux",
    versions: [
      {
        type: "linuxRPM",
        name: "RPM-based Distros (.rpm)",
        url: release.platforms.linuxRPM?.browser_download_url ?? null,
        size: release.platforms.linuxRPM?.size ?? "-",
      },
      {
        type: "linuxAppImage",
        name: "AppImage (.AppImage)",
        url: release.platforms.linuxAppImage?.browser_download_url ?? null,
        size: release.platforms.linuxAppImage?.size ?? "-",
      },
      {
        type: "linuxDeb",
        name: "Debian/Ubuntu (.deb)",
        url: release.platforms.linuxDeb?.browser_download_url ?? null,
        size: release.platforms.linuxDeb?.size ?? "-",
      },
    ],
    primary: false,
  },
];

---

<Layout title="HardwareVisualizer - Lightweight Hardware Monitoring Tool" lang={lang}>
  <Header t={t.header} lang={lang} />
  <main>
    <Hero t={t.hero} lang={lang} />
    <Screenshots />
    <Usage t={t.usage} lang={lang} />
    <Insights t={t.insights} lang={lang} />
    <Features t={t.features} />
    <Download client:load downloads={downloads} latestVersion={release.version} t={t.download} lang={lang} />

  </main>
  <Footer t={t.footer} lang={lang} />
</Layout>
